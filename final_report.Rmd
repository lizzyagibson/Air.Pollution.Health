---
title: "final_report"
author: "Ahlam Abuawad, Lizzie Gibson, & Yanelli Nunez"
date: "5/2/2018"
output:
  html_document:
    toc: true
    toc_float: true
---

**Describe your data set. Provide proper motivation for your work.**
**What questions are you trying to answer?**

###INTRODUCTION 
The World Health Organization has place air pollution as the world’s largest environmental health risk factor. Air pollution is a leading environmental threat to the health of urban populations overall. Although, clean air laws and regulations have improved the air quality in New York and most other large cities, several pollutants in the city’s air are at levels that are harmful. In the present study, we assess the potential association between exposure to high levels of air pollution and risk for hospitalizations due to respiratory diseases in New York City for the year 2015. We leverage data from the New York Statewide Planning and Research Cooperative System (SPARCS) and the Environmental Protection Agency’s Air Quality System (AQS) database. 

**Air pollution variables**
We obtain air pollution data from the US EPA Air Quality (AQS) database, which have been extensively used in previous health studies. Specifically, we obtain daily data for total PM2.5 mass concentrations, ozone and the following species: sulfate, nitrate, aluminum, calcium, iron, silicon, lead, manganese, zinc, bromine, copper, nickel, sulfur, and vanadium

**Outcome: Number of hospitalizations due to respiratory disease.** 
The New York Department of Health Statewide Planning and Research Cooperative System (SPARCS) is a comprehensive data reporting system that collects information on hospital admissions and emergency department (ED) visits within New York State. The SPARCS dataset contains information on approximately 98% of all hospitalizations in non-federal acute care facilities regardless of insurance status. Information on patient characteristics, diagnoses, treatments, services and charges is also collected for each hospitalization or ED visit. Additionally, the dataset includes demographic information such as age, sex, race, and residential address. A unique patient ID is assigned to each person to allow for tracking hospitalizations or ED visits over time. We will use SPARCS data on hospital admission and ED visits from the years 2015 to determine the number of respiratory disease hospitalizations in New York City. 

**Cofounders**
Weather conditions influence air pollution levels by concentrating, diluting or chemically processing pollutants; therefore, we will include temperature in our analysis. Data for the temperature variable will be obtain from the AQS database (see description above).

Through this study we aim to answer the question on whether exposure to high levels of air pollution increases the number of respiratory disease hospitalizations in New York City. For this, we will use a combination of supervised and unsupervised data analysis including lasso, random forest tree and principal component analysis. 


**How did you prepare and clean the data?**


# Unsupervised Analysis/Exploratory Data Analysis (EDA)

*Here you can use any techniques as long as they are adequately explained. If you don’t find anything interesting, then describe what you tried, and show that there isn’t much visible structure. Data science is NOT manipulating the data in some way until you get an answer.*

**Is there any interesting structure present in the data?**

In the EDA, the first boxplot of the PM 2.5 species shows that by a large difference, sulfur is the pollutant with the highest concentration (and standard deviation). The second boxplot of Criteria gas and particulate concentrations shows that NO2 has a larger concentration than all of the PM 2.5 species combined. 

For the unsupervised analysis, we also used a Principal Component Analysis (PCA). This is a low-dimensional representation of the data that captures as much of the information as possible, to which each of the n observations exists in a p-dimensional space. PCA seeks a small number of dimensions that are all as "interesting" as possible (not all dimensions are equally interesting), which is measured by the amount that the observations vary along each dimension. Each of the dimensions found by PCA is a linear combination of the p features. The first two principal components of a data set span the plane that is closest to the n observations in terms of average squared Euclidean distance. PCA requires strong assumptions, including multiple continuous variables, a linear relationship between all variables, a large enough sample size, correlations between variables to form uncorrelate components, and no significant outliers (as PCA is very susceptible to outliers). 

We chose PCA because the dataset contains a large amount of variables, and PCA will help to understand which variables comprise a majority of the variability in the data. 

**What were your findings? What insights into the data can you make?**

A heat map of the data reveals that PC1, which comprises most of the variability in the dataset (~35%), contains four out of five of the criteria air pollutants (PM 2.5, NO2, CO, and SO2). The fifth criteria air pollutant, ozone, was not in PC1 but did appear in the other PC's to varying extents. In fact, the plot of the eigenvectors shows that ozone is in a different dimensional space compared to all of the other variables in the dataset. NO2, CO, and SO2 are in a similar dimensional space, and PM 2.5 is more similar to those three criteria air pollutants, but is also in a different dimensional space. 

In comparing week days and weekends, 


# Supervised Analysis

*You can use any of the classification/regression techniques that we learned in the course, or any other techniques as long as they are adequately described.*
**What predictor variables did you include?**
**What technique did you use, and why did you choose it? What assumptions, if any, are being made by using this technique?**

###Lasso
For our supervised analyses we use lasso. The predictor variables we use in this analysis are: total PM2.5 mass concentrations, ozone, sulfate, nitrate, aluminum, calcium, iron, silicon, lead, manganese, zinc, bromine, copper, nickel, sulfur, vanadium and temperature. Lasso is a variable selection method that yields sparse models, that is, models that are easier to interpret in comparison to ridge regression. This is due to the fact that depending on the choice of the lambda parameter (Figure 1), some of the coefficients will be exactly equal to zero which helps produce a more simplify model. It is also important to mention that lasso relies on a linear model and assumes noncorrelation between the variables. 

For the analysis we split the data into a train and test dataset. We use the train dataset to fit the lasso model and find the best lambda value using cross-validation. Then use the test dataset to test the performance of our model. 

**Results** 
The best lambda value that we found through cross-validation is 4.479. In figure 2, we can also see that when testing multiple data values in the train dataset, the lambda value that produces the lower mean square error (MSE) is around 4. The lasso model with the lambda chosen by cross-validation contains only 10 variables (table 1). 
The MSE from the prediction using the train dataset is 2177.17 and the MSE using the test dataset is 6587.115

For our supervised analyses we used lasso and boosted random forests. 

**If there were tuning parameters, how did you pick their values?**


**How did you make your predictions?**


**Discuss the training/test performance if you have a test data set (or you could split the data into two parts).**


**Can you explain anything about the nature of the relationship between the predictors in your model and the predictions themselves?**


**What were your findings? Are they what you expect? What insights into the data can you make?**


